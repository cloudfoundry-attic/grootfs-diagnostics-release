#!/bin/bash

report_dstate_count() {
  currenttime=$(date +%s)
  count=$1

  echo "${currenttime}: Total D-State processes: ${count}"

  /var/vcap/packages/metatron/bin/metatron --metron-endpoint="127.0.0.1:<%= p('grootfs-diagnostics.dropsonde_port') %>" \
    --prefix="grootfs" \
    --name="dstate-processes" \
    --value=$count
}

report_dstate_count "$1"
